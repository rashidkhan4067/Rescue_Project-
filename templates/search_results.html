{% extends "base.html" %}
{% block title %}Search Results - Missing Person Finder{% endblock %}
{% block head_extra %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
{% endblock %}
{% block content %}

<!-- Search Results Hero -->
<section class="search-results-hero">
    <div class="hero-content">
        <h1 data-aos="fade-up">Search Results</h1>
        <p data-aos="fade-up" data-aos-delay="200">
            {% if query %}
                Showing results for "<strong>{{ query }}</strong>"
            {% else %}
                Browse all missing person reports
            {% endif %}
        </p>
    </div>
</section>

<!-- Search Results Content -->
<section class="search-results-content">
    <div class="content-container">
        <!-- Search Stats -->
        <div class="search-stats" data-aos="fade-up">
            <div class="stats-info">
                <span class="results-count">{{ total_results }} results found</span>
                {% if query %}
                <span class="search-query">for "{{ query }}"</span>
                {% endif %}
            </div>
            <div class="search-actions">
                <button class="filter-toggle-btn" onclick="toggleFilters()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    Filters
                </button>
                <select class="sort-select" onchange="handleSort(this.value)">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="name">Name A-Z</option>
                    <option value="area">Location</option>
                </select>
            </div>
        </div>

        <!-- Advanced Filters Panel -->
        <div class="filters-panel" id="filtersPanel" style="display: none;">
            <div class="filters-content" data-aos="fade-up" data-aos-delay="100">
                <h3>Advanced Filters</h3>
                <form class="filters-form" onsubmit="applyFilters(event)">
                    <div class="filter-group">
                        <label>Age Range</label>
                        <div class="age-inputs">
                            <input type="number" placeholder="Min age" name="min_age" min="0" max="120">
                            <span>to</span>
                            <input type="number" placeholder="Max age" name="max_age" min="0" max="120">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Gender</label>
                        <select name="gender">
                            <option value="">All Genders</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Location</label>
                        <input type="text" placeholder="Enter location..." name="location">
                    </div>
                    <div class="filter-group">
                        <label>Date Range</label>
                        <select name="date_range">
                            <option value="">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="button" class="clear-filters-btn" onclick="clearFilters()">Clear All</button>
                        <button type="submit" class="apply-filters-btn">Apply Filters</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Grid -->
        <div class="results-grid" data-aos="fade-up" data-aos-delay="300">
            {% if results %}
                {% for report in results %}
                <div class="result-card" data-aos="zoom-in" data-aos-delay="{{ loop.index0 * 50 }}">
                    <div class="card-header">
                        <div class="status-badge active">üîç Active</div>
                        <div class="report-id">#{{ report.id }}</div>
                    </div>
                    
                    {% if report.image %}
                    <div class="card-image">
                        <img src="{{ report.image }}" alt="{{ report.name }}" loading="lazy">
                        <div class="image-overlay">
                            <button class="view-btn" onclick="viewReport({{ report.id }})">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {% else %}
                    <div class="card-image-placeholder">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        <span>No Photo</span>
                    </div>
                    {% endif %}
                    
                    <div class="card-content">
                        <h3 class="person-name">{{ report.name }}</h3>
                        <div class="person-details">
                            <div class="detail-item">
                                <span class="detail-label">Age:</span>
                                <span class="detail-value">{{ report.age }} years</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Gender:</span>
                                <span class="detail-value">{{ report.gender }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Last Seen:</span>
                                <span class="detail-value">{{ report.area }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Reported:</span>
                                <span class="detail-value">{{ report.created_at }}</span>
                            </div>
                        </div>
                        <div class="description">
                            <p>{{ report.description }}</p>
                        </div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="action-btn primary" onclick="viewReport({{ report.id }})">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            View Details
                        </button>
                        <button class="action-btn secondary" onclick="shareReport({{ report.id }})">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                            Share
                        </button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="no-results" data-aos="fade-up">
                <div class="no-results-icon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <h3>No Results Found</h3>
                <p>
                    {% if query %}
                        We couldn't find any reports matching "{{ query }}". Try adjusting your search terms or using different keywords.
                    {% else %}
                        No missing person reports are currently available.
                    {% endif %}
                </p>
                <div class="no-results-actions">
                    <a href="{{ url_for('main.index') }}" class="btn-primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        Back to Home
                    </a>
                    <a href="{{ url_for('main.report') }}" class="btn-secondary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="12" y1="11" x2="12" y2="17"></line>
                            <line x1="9" y1="14" x2="15" y2="14"></line>
                        </svg>
                        Report Missing Person
                    </a>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Pagination -->
        {% if pagination and pagination.pages > 1 %}
        <div class="pagination-container" data-aos="fade-up" data-aos-delay="400">
            <div class="pagination">
                {% if pagination.has_prev %}
                <a href="{{ url_for('main.search', q=query, page=pagination.prev_num) }}" class="page-btn prev">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    Previous
                </a>
                {% endif %}
                
                {% for page_num in pagination.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != pagination.page %}
                        <a href="{{ url_for('main.search', q=query, page=page_num) }}" class="page-btn">{{ page_num }}</a>
                        {% else %}
                        <span class="page-btn active">{{ page_num }}</span>
                        {% endif %}
                    {% else %}
                    <span class="page-btn dots">...</span>
                    {% endif %}
                {% endfor %}
                
                {% if pagination.has_next %}
                <a href="{{ url_for('main.search', q=query, page=pagination.next_num) }}" class="page-btn next">
                    Next
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    // Initialize AOS
    AOS.init({
        duration: 800,
        easing: 'ease-out-cubic',
        once: true,
        offset: 50
    });

    // Toggle filters panel
    function toggleFilters() {
        const panel = document.getElementById('filtersPanel');
        const isVisible = panel.style.display !== 'none';
        panel.style.display = isVisible ? 'none' : 'block';
        
        if (!isVisible) {
            AOS.refresh();
        }
    }

    // Handle sorting
    function handleSort(sortBy) {
        const url = new URL(window.location);
        url.searchParams.set('sort', sortBy);
        window.location.href = url.toString();
    }

    // Apply filters
    function applyFilters(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const url = new URL(window.location);
        
        // Add filter parameters to URL
        for (const [key, value] of formData.entries()) {
            if (value) {
                url.searchParams.set(key, value);
            } else {
                url.searchParams.delete(key);
            }
        }
        
        window.location.href = url.toString();
    }

    // Clear filters
    function clearFilters() {
        const form = document.querySelector('.filters-form');
        form.reset();
        
        const url = new URL(window.location);
        const query = url.searchParams.get('q');
        
        // Keep only the search query
        url.search = '';
        if (query) {
            url.searchParams.set('q', query);
        }
        
        window.location.href = url.toString();
    }

    // View report details
    function viewReport(reportId) {
        window.location.href = `{{ url_for('main.report_details', report_id=0) }}`.replace('0', reportId);
    }

    // Share report
    function shareReport(reportId) {
        const reportUrl = `{{ url_for('main.report_details', report_id=0) }}`.replace('0', reportId);
        
        if (navigator.share) {
            navigator.share({
                title: 'Missing Person Report',
                text: 'Help us find this missing person.',
                url: reportUrl
            }).catch(console.error);
        } else {
            navigator.clipboard.writeText(reportUrl).then(() => {
                alert('Report link copied to clipboard!');
            }).catch(() => {
                alert('Unable to copy link');
            });
        }
    }
</script>

{% endblock %}
